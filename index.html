<!doctype html>
<meta charset='utf-8'>
<title>Animal Hunt AR</title>
<meta name='viewport' content='width=device-width, initial-scale=1'>
<style>
  body { margin: 0; font-family: Arial; }
  #camera { width: 100%; height: 100vh; display: block; object-fit: cover; }
  #game { position: relative; width: 100%; height: 100vh; overflow: hidden; background: black; }
  .animal { position: absolute; text-shadow: 0 0 10px rgba(0,0,0,0.8); transition: font-size 0.1s, opacity 0.3s; filter: drop-shadow(0 0 5px rgba(255,255,255,0.3)); }
  #permissionBtn { position: absolute; top: 20px; left: 20px; z-index: 100; padding: 12px 20px; font-size: 16px; background: #4CAF50; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; }
  #permissionBtn:disabled { background: #45a049; }
  #info { position: absolute; bottom: 20px; left: 20px; color: white; background: rgba(0,0,0,0.7); padding: 15px; border-radius: 5px; font-size: 14px; }
</style>

<button id="permissionBtn">Start Hunting</button>

<div id="game">
  <video id="camera" autoplay playsinline></video>
  <div id="animals"></div>
</div>

<div id="info">Move your iPad around to find animals!</div>

<script>
  const video = document.getElementById('camera');
  const animalsContainer = document.getElementById('animals');
  const animalEmojis = ['ðŸ¦', 'ðŸ˜', 'ðŸ¦’', 'ðŸ…', 'ðŸ¦“', 'ðŸ»', 'ðŸ¦Š', 'ðŸ’', 'ðŸ¦', 'ðŸƒ'];
  const placedAnimals = [];
  let tiltForward = 0;
  let motionEnabled = false;

  // Start camera
  navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } })
    .then(stream => video.srcObject = stream)
    .catch(() => alert('Camera access denied'));

  // Request motion permission on button click
  document.getElementById('permissionBtn').addEventListener('click', async () => {
    if (typeof DeviceOrientationEvent !== 'undefined' && typeof DeviceOrientationEvent.requestPermission === 'function') {
      try {
        const permission = await DeviceOrientationEvent.requestPermission();
        if (permission === 'granted') {
          motionEnabled = true;
          document.getElementById('permissionBtn').textContent = 'âœ“ Hunting Started';
          document.getElementById('permissionBtn').disabled = true;
          startSpawning();
        }
      } catch (error) {
        alert('Motion permission denied');
      }
    } else {
      motionEnabled = true;
      document.getElementById('permissionBtn').textContent = 'âœ“ Hunting Started';
      document.getElementById('permissionBtn').disabled = true;
      startSpawning();
    }
  });

  // Track phone tilt
  window.addEventListener('deviceorientation', (event) => {
    tiltForward = event.beta || 0;
  });

  function startSpawning() {
    // Spawn 8-10 animals at fixed positions at the start
    for (let i = 0; i < 8; i++) {
      spawnAnimalAtPosition();
    }
    
    // Occasionally add new animals
    setInterval(() => {
      if (placedAnimals.length < 12 && Math.random() > 0.7) {
        spawnAnimalAtPosition();
      }
    }, 3000);
  }

  function spawnAnimalAtPosition() {
    const animal = document.createElement('div');
    animal.className = 'animal';
    animal.textContent = animalEmojis[Math.floor(Math.random() * animalEmojis.length)];
    
    // Random position across the screen
    const left = Math.random() * 85 + '%';
    const top = Math.random() * 80 + '%';
    animal.style.left = left;
    animal.style.top = top;
    
    // Store position (doesn't change)
    const animalObj = {
      element: animal,
      baseSize: 50 + Math.random() * 30,
      left: left,
      top: top,
      opacity: 0.6 + Math.random() * 0.4
    };
    
    animal.style.fontSize = animalObj.baseSize + 'px';
    animal.style.opacity = animalObj.opacity;
    placedAnimals.push(animalObj);
    animalsContainer.appendChild(animal);

    // Remove after 15 seconds
    setTimeout(() => {
      animal.style.opacity = '0';
      setTimeout(() => {
        animal.remove();
        placedAnimals.splice(placedAnimals.indexOf(animalObj), 1);
      }, 300);
    }, 15000);
  }

  // Update animal sizes based on tilt (you moving closer)
  setInterval(() => {
    placedAnimals.forEach(a => {
      // Tilt forward = bigger (simulates you walking closer)
      let newSize = a.baseSize + (tiltForward * 1.5);
      newSize = Math.max(a.baseSize * 0.7, Math.min(a.baseSize * 3, newSize));
      a.element.style.fontSize = newSize + 'px';
    });
  }, 50);
</script>
